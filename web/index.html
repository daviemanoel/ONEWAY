<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONE WAY 2025 - Evento Oficial</title>
    <link rel="stylesheet" type="text/css" href="./Css/style.css">
    <link rel="stylesheet" type="text/css" href="./Css/modal-checkout.css">
    <link rel="icon" type="image/png" href="./img/2.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Header com Navega√ß√£o Fixa -->
    <header class="navbar">
        <nav class="nav-container">
            <a href="#" class="logo">ONE WAY 2025</a>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link">In√≠cio</a></li>
                <li><a href="#minha-secao" class="nav-link">Ingressos</a></li>
                <li><a href="#sobre" class="nav-link">Sobre</a></li>
                <li><a href="#produtos" class="nav-link">Produtos</a></li>
                <li><a href="#faq" class="nav-link">FAQ</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <section id="home" class="section_home">
        <div style="position: relative; display: inline-block; width:100%">
            <img class="img-desktop" src="./img/One_Way_25-conv.png" alt="ONE WAY 2025 Banner" loading="eager" decoding="async">
            <img class="img-mobile" src="./img/One_Way_25-conv.png" alt="ONE WAY 2025 Mobile Banner" loading="eager" decoding="async">
        </div>
    </section>

    <section id="sobre" class="convidados">
        <div class="convidados__container">
            <div class="convidados__content">
                <h1 class="convidados__title">ONE WAY 2025</h1>
                <div class="convidados__text">
                    <p>Cremos que Deus est√° levantando uma gera√ß√£o que n√£o negocia o Caminho. Jovens apaixonados por Jesus, cheios do Esp√≠rito Santo, que desejam n√£o apenas falar sobre Ele, mas se parecer com Ele ‚Äî em car√°ter, em autoridade e em entrega.</p>
                    <p>O One Way √© mais do que um evento: √© um ajuntamento de filhos que decidiram viver para construir um lugar de habita√ß√£o para a Presen√ßa. Um povo que entende que h√° um √∫nico caminho, e que esse caminho √© suficiente.</p>
                    <p>Queremos, juntos, formar Cristo uns nos outros ‚Äî para que a paix√£o pelo evangelho se transforme em miss√£o, e a miss√£o em frutos que permane√ßam.</p>
                    <p>Porque o mundo n√£o precisa de mais entretenimento. Ele precisa de uma gera√ß√£o que conhe√ßa o Caminho.</p>
                </div>
            </div>
            <div class="convidados__image">
                <img src="./img/fundoteste.jpg" alt="ONE WAY 2025" class="convidados__img" loading="lazy" decoding="async">
            </div>
        </div>

    </section>

    <section id="produtos" class="section_products">
        <div class="products-container" id="products-container">
            <!-- Produtos ser√£o carregados dinamicamente via JavaScript -->
        </div>
    </section>

    <section id="minha-secao" class="section_date_tickets">
        <div class="table-container">
            <table class="date-tickets-table">
                <tr>
                    <td class="date-column">
                        <div class="date-header">
                            <h2>üìÖ Save the Date</h2>
                        </div>
                        <div class="date-info">
                            <div class="event-date">31 DE JULHO √Ä 02 DE AGOSTO</div>
                            <div class="event-year">2025</div>
                            <div class="event-location">
                                <div class="location-name">Mevam Franca</div>
                                <div class="location-city">Rua S√£o Paulo, 1151 - Vila Aparecida, Franca - SP</div>
                            </div>
                        </div>
                    </td>
                    <td class="tickets-column">
                        <div class="tickets-header">
                            <h2>Garanta seu ingresso</h2>
                        </div>
                        <div class="tickets-list">
                            <div class="ticket-item esgotado">
                                <span class="lote-name">Lote 1</span>
                                <span class="status">ESGOTADO</span>
                                <span class="price">---</span>
                            </div>
                            <div class="ticket-item esgotado">
                                <span class="lote-name">Lote 2</span>
                                <span class="status">ESGOTADO</span>
                                <span class="price">---</span>
                            </div>
                            <div class="ticket-item disponivel">
                                <span class="lote-name">Lote 3</span>
                                <span class="status">DISPON√çVEL</span>
                                <span class="price">R$ 170,00</span>
                                <a href="https://tiketo.com.br/evento/3063" target="_blank" class="buy-btn">Comprar</a>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </section>

    <section id="faq" class="saq">
        <div class="faq-container">
            <img src="./img/FAQ.png" alt="FAQ" class="faq-logo" loading="lazy" decoding="async">
            <div class="faq-grid">
                <div class="faq-item">
                    <button class="faq-question active">‚ñ∏ Quem pode participar do evento? </button>
                    <div class="faq-answer">Todos os jovens e adolecentes s√£o bem-vindos! O evento √© aberto para quem
                        deseja se
                        conectar com Deus, fazer novas amizades e viver algo especial. Mesmo que voc√™ n√£o fa√ßa parte da
                        nossa igreja, pode participar! </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏Qual o hor√°rio de in√≠cio e t√©rmino? </button>
                    <div class="faq-answer">O evento come√ßa pontualmente Quinta e Sexta √†s 19:00 e termina por volta das
                        00:00, e Sabado abrimos 08:00 e termina por volta das 21:00. Recomendamos chegar com pelo menos
                        15 minutos de anteced√™ncia para garantir seu lugar e se organizar com calma.
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Vai ter alimenta√ß√£o no evento?</button>
                    <div class="faq-answer">Sim! Teremos momentos de intervalo com alimenta√ß√£o dispon√≠vel. A compra da
                        alimenta√ß√£o poder√° ser feita junto com o ingresso, diretamente no site. Importante: n√£o ser√°
                        poss√≠vel adquirir almo√ßo ou jantar durante o evento.</div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Tem limite de idade para participar?</button>
                    <div class="faq-answer">N√£o teremos limita√ß√£o de idades para adolescentes e jovens, incluindo casais
                        casados que ainda n√£o t√™m filhos. Todos s√£o muito bem-vindos!</div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏Posso levar um amigo que n√£o √© da igreja? </button>
                    <div class="faq-answer">Claro! Voc√™ est√° mais do que convidado a trazer amigos, mesmo que eles n√£o
                        fa√ßam parte da igreja. O evento √© para todos que querem viver algo novo com Deus.
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Posso sair e voltar durante o evento? </button>
                    <div class="faq-answer">Pedimos que os participantes permane√ßam no local durante todo o evento para
                        garantir seguran√ßa e n√£o perder nenhuma parte da programa√ß√£o. Em casos especiais, fale com a
                        equipe respons√°vel na entrada.</div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Pode tirar fotos e postar nas redes sociais?</button>
                    <div class="faq-answer">Sim! Amamos ver voc√™s registrando e compartilhando os momentos especiais. S√≥
                        pedimos que respeite os outros participantes ao tirar fotos e que marque nosso perfil oficial
                        nas redes sociais! </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Vai ter algum tipo de roupa espec√≠fica ou dress code? </button>
                    <div class="faq-answer">N√£o temos um dress code obrigat√≥rio, mas recomendamos roupas confort√°veis e
                        modestas, adequadas para momentos de adora√ß√£o, din√¢micas e comunh√£o. Pedimos apenas que todos
                        usem roupas apropriadas para o ambiente, respeitando os demais participantes do evento.
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Quem eu posso procurar se tiver d√∫vidas no dia do evento? </button>
                    <div class="faq-answer">Durante o evento, teremos uma equipe identificada com crach√°s ou camisetas
                        da organiza√ß√£o que estar√° dispon√≠vel para te ajudar com qualquer d√∫vida. Procure por algu√©m da
                        equipe de recep√ß√£o ou v√° at√© o ponto de apoio na entrada ‚Äî estaremos prontos pra te atender!
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">‚ñ∏ Preciso levar meu documento ou comprovante de inscri√ß√£o? </button>
                    <div class="faq-answer">Sim, √© importante levar um documento com foto e, se tiver feito inscri√ß√£o
                        online, apresentar o comprovante (impresso ou no celular). Isso ajuda a agilizar sua entrada e
                        garante que tudo ocorra com seguran√ßa¬†e¬†organiza√ß√£o.
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section>
        <div class="div_rodape">
            <img src="./img/rodape.png" alt="" loading="lazy" decoding="async">
        </div>
    </section>

    <script>
        // Menu hamb√∫rguer
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');
        
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // Fechar menu ao clicar em um link
        document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        }));

        // Navega√ß√£o suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // FAQ functionality
        const buttons = document.querySelectorAll('.faq-question');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                buttons.forEach(b => {
                    if (b !== btn) {
                        b.classList.remove('active');
                        b.nextElementSibling.classList.remove('show');
                        b.innerText = b.innerText.replace('‚ñ¥', '‚ñ∏');
                    }
                });

                btn.classList.toggle('active');
                const answer = btn.nextElementSibling;
                answer.classList.toggle('show');
                btn.innerText = btn.classList.contains('active')
                    ? btn.innerText.replace('‚ñ∏', '‚ñ¥')
                    : btn.innerText.replace('‚ñ¥', '‚ñ∏');
            });
        });

        // Fun√ß√£o para comprar camiseta
        function comprarCamiseta() {
            const sizeSelected = document.querySelector('input[name="camiseta-size"]:checked');
            if (sizeSelected) {
                const size = sizeSelected.value;
                window.open('https://buy.stripe.com/dRm4gz0bG2B96sFbtu18c00', '_blank');
            } else {
                alert('Por favor, selecione um tamanho antes de continuar.');
            }
        }

        // Navbar transparente ao rolar
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        
        // Funcionalidade dos bot√µes de tamanho
        function initSizeButtons() {
            document.querySelectorAll('.size-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active de todos os bot√µes do mesmo produto
                    const parentSelector = this.closest('.size-selector');
                    parentSelector.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
                    // Adiciona active no clicado
                    this.classList.add('active');
                    
                });
            });
            
            // Adicionar evento aos bot√µes de comprar
            document.querySelectorAll('.product-btn').forEach(button => {
                button.addEventListener('click', function() {
                    
                    // Redirecionar para o site de compras
                    window.open('https://tiketo.com.br/evento/3063', '_blank');
                });
            });
        }

        // Vari√°vel global para configura√ß√£o de pagamentos
        let paymentConfig = {
            cartao: 'PAYPAL',
            pix: 'MERCADOPAGO'
        };

        // Carregar configura√ß√£o de pagamentos
        async function loadPaymentConfig() {
            try {
                const response = await fetch('/api/payment-config');
                const data = await response.json();
                paymentConfig = data.config;
                console.log('üîß Configura√ß√£o de pagamentos carregada:', paymentConfig);
                return paymentConfig;
            } catch (error) {
                console.error('‚ùå Erro ao carregar configura√ß√£o de pagamentos:', error);
                console.log('‚ö†Ô∏è Usando configura√ß√£o padr√£o:', paymentConfig);
                return paymentConfig;
            }
        }

        // Carregar produtos do JSON
        async function loadProducts() {
            try {
                // Carregar configura√ß√£o de pagamentos primeiro
                await loadPaymentConfig();
                
                const response = await fetch('./products.json');
                const data = await response.json();
                
                // Converter objeto em array e ordenar por ID
                const productsArray = Object.values(data.products).sort((a, b) => parseInt(a.id) - parseInt(b.id));
                
                const container = document.getElementById('products-container');
                container.innerHTML = '';
                
                productsArray.forEach(product => {
                    const hasVideo = product.video && product.video !== '';
                    const hasMultipleImages = product.images && product.images.length > 1;
                    const images = hasMultipleImages ? product.images : [product.image];
                    
                    // Criar array de items incluindo v√≠deo se existir
                    const mediaItems = [...images];
                    if (hasVideo) {
                        mediaItems.push(product.video);
                    }
                    
                    const hasGallery = mediaItems.length > 1;
                    
                    const productHTML = `
                        <div class="product-card" data-product-id="${product.id}" data-product-price="${product.price}">
                            <div class="product-image ${hasGallery ? 'has-gallery' : ''}">
                                ${mediaItems.map((item, index) => {
                                    const isVideo = item.includes('.mp4');
                                    if (isVideo) {
                                        return `<video class="product-video ${index === 0 ? 'active' : ''}" 
                                                       muted loop playsinline preload="metadata" 
                                                       data-media-index="${index}">
                                                    <source src="${item}" type="video/mp4">
                                                </video>`;
                                    } else {
                                        return `<img src="${item}" alt="${product.title}" loading="lazy" decoding="async" 
                                                     class="product-img ${index === 0 ? 'active' : ''}" 
                                                     data-media-index="${index}">`;
                                    }
                                }).join('')}
                                ${hasGallery ? `
                                    <div class="image-dots">
                                        ${mediaItems.map((item, index) => {
                                            const isVideo = item.includes('.mp4');
                                            return `<span class="dot ${index === 0 ? 'active' : ''}" 
                                                          data-media-index="${index}" 
                                                          data-is-video="${isVideo}">
                                                        ${isVideo ? '‚ñ∂' : ''}
                                                    </span>`;
                                        }).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="product-info">
                                <h3>${product.title}</h3>
                                <div class="product-price">R$ ${product.price.toFixed(2).replace('.', ',')}</div>
                                <div class="pix-price">PIX: R$ ${(product.price * 0.95).toFixed(2).replace('.', ',')} <span class="discount-label">(5% OFF)</span></div>
                                <div class="size-selector">
                                    <div class="size-options">
                                        ${Object.entries(product.sizes).map(([size, sizeData]) => {
                                            const isAvailable = sizeData.available;
                                            const isActive = size === 'M' && isAvailable;
                                            const disabled = !isAvailable ? 'disabled' : '';
                                            const activeClass = isActive ? 'active' : '';
                                            return `<button class="size-btn ${activeClass}" data-size="${size}" data-stripe-id="${sizeData.id_stripe}" ${disabled}>${size}</button>`;
                                        }).join('')}
                                    </div>
                                </div>
                                <div class="payment-selector">
                                    <label>Forma de pagamento:</label>
                                    <select class="payment-method">
                                        <option value="pix">PIX - 5% de Desconto</option>
                                        <option value="cartao">Cart√£o de Cr√©dito</option>
                                    </select>
                                </div>
                                <button class="product-btn" data-product-id="${product.id}">Comprar Agora</button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += productHTML;
                });
                
                // Reinicializar funcionalidades ap√≥s carregar produtos
                initSizeButtons();
                initImageGallery();
                
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                // Fallback: mostrar mensagem de erro
                document.getElementById('products-container').innerHTML = '<p>Erro ao carregar produtos. Tente novamente.</p>';
            }
        }

        // Funcionalidade dos bot√µes de tamanho (atualizada)
        function initSizeButtons() {
            document.querySelectorAll('.size-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (this.disabled) return;
                    
                    // Remove active de todos os bot√µes do mesmo produto
                    const parentSelector = this.closest('.size-selector');
                    parentSelector.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
                    // Adiciona active no clicado
                    this.classList.add('active');
                    
                });
            });
            
            // Adicionar evento aos bot√µes de comprar (dual payment)
            document.querySelectorAll('.product-btn').forEach(button => {
                button.addEventListener('click', async function() {
                    
                    // Pegar tamanho selecionado
                    const productCard = this.closest('.product-card');
                    const selectedSizeBtn = productCard.querySelector('.size-btn.active');
                    const productId = this.dataset.productId;
                    const paymentMethod = productCard.querySelector('.payment-method').value;
                    
                    if (!selectedSizeBtn) {
                        alert('Por favor, selecione um tamanho dispon√≠vel.');
                        return;
                    }
                    
                    const size = selectedSizeBtn.dataset.size;
                    const priceId = selectedSizeBtn.dataset.stripeId;
                    const productName = productCard.querySelector('h3').textContent;
                    const productPrice = parseFloat(productCard.dataset.productPrice);
                    
                    if (!priceId || priceId === 'null') {
                        alert('Tamanho indispon√≠vel para compra.');
                        return;
                    }
                    
                    // Desabilitar bot√£o durante processamento
                    this.disabled = true;
                    this.textContent = 'Processando...';
                    
                    try {
                        // Abrir modal de dados do comprador
                        openCheckoutModal({
                            productId: productId,
                            priceId: priceId,
                            productName: productName,
                            size: size,
                            paymentMethod: paymentMethod,
                            installments: paymentMethod === 'pix' ? 1 : (paymentMethod === 'cartao' ? 1 : parseInt(paymentMethod)),
                            price: productPrice // S√≥ para exibi√ß√£o no modal - backend ignora
                        });
                    } catch (error) {
                        console.error('Erro ao abrir checkout:', error);
                        alert('Erro ao abrir formul√°rio. Tente novamente.');
                    } finally {
                        // Restaurar bot√£o
                        this.disabled = false;
                        this.textContent = 'Comprar Agora';
                    }
                });
            });
        }


        // Fun√ß√£o para controlar galeria unificada (imagens + v√≠deo)
        function initImageGallery() {
            document.querySelectorAll('.product-image.has-gallery').forEach(container => {
                const dots = container.querySelectorAll('.dot');
                const images = container.querySelectorAll('.product-img');
                const videos = container.querySelectorAll('.product-video');
                const allMedia = container.querySelectorAll('[data-media-index]');
                
                dots.forEach(dot => {
                    dot.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const mediaIndex = parseInt(dot.dataset.mediaIndex);
                        const isVideo = dot.dataset.isVideo === 'true';
                        
                        // Remove active de todos
                        dots.forEach(d => d.classList.remove('active'));
                        allMedia.forEach(media => {
                            media.classList.remove('active');
                            // Parar v√≠deos que n√£o est√£o ativos
                            if (media.tagName === 'VIDEO') {
                                media.pause();
                                media.currentTime = 0;
                            }
                        });
                        
                        // Adiciona active no selecionado
                        dot.classList.add('active');
                        allMedia[mediaIndex].classList.add('active');
                        
                        // Se for v√≠deo, reproduzir
                        if (isVideo && allMedia[mediaIndex].tagName === 'VIDEO') {
                            allMedia[mediaIndex].play().catch(e => console.log('Video play failed:', e));
                        }
                    });
                });
            });
        }

        // ========== MODAL DE CHECKOUT ==========
        let currentCheckoutData = null;

        function openCheckoutModal(checkoutData) {
            currentCheckoutData = checkoutData;
            
            // Usar o pre√ßo real do produto
            let amount = checkoutData.price || 120.00;
            if (checkoutData.paymentMethod === 'pix') {
                amount = amount * 0.95; // 5% de desconto
            }
            
            // Preencher resumo do pedido
            document.getElementById('product-summary-text').textContent = 
                `${checkoutData.productName} - Tamanho ${checkoutData.size}`;
                
            const paymentMethodText = checkoutData.paymentMethod === 'pix' 
                ? 'PIX (5% de desconto)' 
                : 'Cart√£o de Cr√©dito';
                    
            document.getElementById('price-summary-text').innerHTML = 
                checkoutData.paymentMethod === 'pix' 
                    ? `<s>R$ 120,00</s> R$ ${amount.toFixed(2)} (${paymentMethodText})`
                    : `R$ ${amount.toFixed(2)} (${paymentMethodText})`;
            
            // Limpar formul√°rio
            document.getElementById('checkout-form').reset();
            clearErrors();
            
            // Mostrar modal
            document.getElementById('checkout-modal').style.display = 'block';
        }

        function closeCheckoutModal() {
            document.getElementById('checkout-modal').style.display = 'none';
            currentCheckoutData = null;
        }

        // Valida√ß√£o de campos
        function validateField(field) {
            const value = field.value.trim();
            let isValid = true;
            let errorMessage = '';

            switch(field.type) {
                case 'text':
                    if (value.length < 2) {
                        isValid = false;
                        errorMessage = 'Nome deve ter pelo menos 2 caracteres';
                    }
                    break;
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        isValid = false;
                        errorMessage = 'Digite um e-mail v√°lido';
                    }
                    break;
                case 'tel':
                    const phoneRegex = /^\(\d{2}\)\s\d{4,5}-\d{4}$/;
                    if (!phoneRegex.test(value)) {
                        isValid = false;
                        errorMessage = 'Use o formato: (11) 99999-9999';
                    }
                    break;
            }

            showFieldError(field, isValid, errorMessage);
            return isValid;
        }

        function showFieldError(field, isValid, errorMessage) {
            const formGroup = field.closest('.form-group');
            let errorElement = formGroup.querySelector('.error-message');
            
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.className = 'error-message';
                formGroup.appendChild(errorElement);
            }

            if (isValid) {
                field.classList.remove('error');
                errorElement.style.display = 'none';
            } else {
                field.classList.add('error');
                errorElement.textContent = errorMessage;
                errorElement.style.display = 'block';
            }
        }

        function clearErrors() {
            document.querySelectorAll('.form-group input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
        }

        // M√°scara de telefone
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 10) {
                value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 6) {
                value = value.replace(/(\d{2})(\d{4})/, '($1) $2');
            } else if (value.length >= 2) {
                value = value.replace(/(\d{2})/, '($1) ');
            }
            input.value = value;
        }

        // Processar checkout final
        async function processCheckout(formData) {
            if (!currentCheckoutData) return;

            const checkoutButton = document.querySelector('.confirm-btn');
            checkoutButton.disabled = true;
            checkoutButton.textContent = 'Processando...';

            try {
                // Determinar qual endpoint usar baseado na configura√ß√£o din√¢mica
                let endpoint;
                let paymentProvider;
                
                if (currentCheckoutData.paymentMethod === 'pix') {
                    // PIX sempre usa o provedor configurado (geralmente Mercado Pago)
                    if (paymentConfig.pix === 'MERCADOPAGO') {
                        endpoint = '/create-mp-checkout';
                        paymentProvider = 'Mercado Pago';
                    } else {
                        throw new Error('PIX n√£o suportado pelo provedor configurado');
                    }
                } else if (currentCheckoutData.paymentMethod === 'cartao') {
                    // Cart√£o usa o provedor configurado (PayPal ou Mercado Pago)
                    if (paymentConfig.cartao === 'PAYPAL') {
                        endpoint = '/create-paypal-order';
                        paymentProvider = 'PayPal';
                    } else if (paymentConfig.cartao === 'MERCADOPAGO') {
                        endpoint = '/create-mp-checkout';
                        paymentProvider = 'Mercado Pago';
                    } else {
                        throw new Error('Provedor de cart√£o n√£o configurado');
                    }
                } else {
                    throw new Error('M√©todo de pagamento inv√°lido');
                }

                console.log(`üîÑ Processando com ${paymentProvider}... (configura√ß√£o: ${JSON.stringify(paymentConfig)})`);

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...currentCheckoutData,
                        // Dados do comprador
                        nome: formData.get('nome'),
                        email: formData.get('email'),
                        telefone: formData.get('telefone')
                    })
                });
                
                const data = await response.json();
                
                if (data.checkout_url || data.approval_url) {
                    // Fechar modal e redirecionar para o checkout
                    closeCheckoutModal();
                    const redirectUrl = data.checkout_url || data.approval_url;
                    console.log(`‚úÖ Redirecionando para ${paymentProvider}:`, redirectUrl);
                    window.location.href = redirectUrl;
                } else {
                    throw new Error(data.error || 'Erro ao processar pagamento');
                }
            } catch (error) {
                console.error('Erro no checkout:', error);
                
                // Verificar se √© erro de token
                if (error.message.includes('invalid_token') || error.message.includes('bad_request')) {
                    alert('‚ö†Ô∏è Sistema em modo de desenvolvimento\n\nPara testar com pagamento real, configure um token v√°lido.\n\nOs dados do pedido foram salvos com sucesso no sistema!');
                } else {
                    alert('Erro ao processar pagamento. Tente novamente.');
                }
            } finally {
                checkoutButton.disabled = false;
                checkoutButton.textContent = 'Confirmar e Pagar';
            }
        }

        // Inicializar quando p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();

            // Event listeners do modal
            document.querySelector('.close').addEventListener('click', closeCheckoutModal);
            document.querySelector('.cancel-btn').addEventListener('click', closeCheckoutModal);
            
            // Fechar modal clicando fora
            window.addEventListener('click', (event) => {
                const modal = document.getElementById('checkout-modal');
                if (event.target === modal) {
                    closeCheckoutModal();
                }
            });

            // Valida√ß√£o em tempo real
            document.getElementById('nome').addEventListener('blur', function() {
                validateField(this);
            });

            document.getElementById('email').addEventListener('blur', function() {
                validateField(this);
            });

            document.getElementById('telefone').addEventListener('input', function() {
                formatPhone(this);
            });

            document.getElementById('telefone').addEventListener('blur', function() {
                validateField(this);
            });

            // Submit do formul√°rio
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar todos os campos
                const fields = this.querySelectorAll('input[required]');
                let allValid = true;
                
                fields.forEach(field => {
                    if (!validateField(field)) {
                        allValid = false;
                    }
                });

                if (allValid) {
                    const formData = new FormData(this);
                    processCheckout(formData);
                } else {
                    alert('Por favor, corrija os erros no formul√°rio.');
                }
            });
        });

    </script>

    <!-- Modal de Dados do Comprador -->
    <div id="checkout-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Finalizar Compra</h2>
            <form id="checkout-form">
                <div class="form-group">
                    <label for="nome">Nome Completo *</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                
                <div class="form-group">
                    <label for="email">E-mail *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="telefone">Telefone/WhatsApp *</label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(11) 99999-9999" required>
                </div>
                
                <div class="product-summary">
                    <h3>Resumo do Pedido:</h3>
                    <p id="product-summary-text"></p>
                    <p id="price-summary-text"></p>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn">Cancelar</button>
                    <button type="submit" class="confirm-btn">Confirmar e Pagar</button>
                </div>
            </form>
        </div>
    </div>

</body>

</html>